<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>8月13日から今日で何日目？</title>
  <style>
    :root {
      --bg: #0b1020;
      --card: #121932;
      --text: #eef3ff;
      --muted: #9fb0d3;
      --accent: #6da8ff;
    }
    html, body {
      height: 100%;
      margin: 0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Hiragino Sans", "Noto Sans JP", "Yu Gothic UI", "Meiryo", sans-serif;
      color: var(--text);
      background: radial-gradient(1200px 800px at 20% 10%, #132147 0%, var(--bg) 50%),
                  radial-gradient(1000px 600px at 80% 70%, #18204b 0%, var(--bg) 60%),
                  var(--bg);
      overflow-x: hidden; /* 横スクロール禁止 */
    }
    .container {
      min-height: 100%;
      display: grid;
      place-items: center;
      padding: 16px;
      box-sizing: border-box;
    }
    .card {
      width: 100%;
      max-width: 760px;
      background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
      backdrop-filter: blur(8px);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.25), inset 0 1px 0 rgba(255,255,255,0.06);
      padding: 20px;
      box-sizing: border-box;
    }
    .title {
      display: flex;
      align-items: center;
      gap: .6rem;
      font-size: clamp(1.2rem, 1rem + 1.2vw, 1.8rem);
      color: var(--text);
      letter-spacing: 0.02em;
      margin: 0 0 10px;
      flex-wrap: wrap;
    }
    .pill {
      font-size: .85rem;
      color: var(--muted);
      background: rgba(109,168,255,0.12);
      border: 1px solid rgba(109,168,255,0.3);
      padding: 6px 10px;
      border-radius: 999px;
      display: inline-flex;
      align-items: center;
      gap: .35rem;
      white-space: nowrap;
    }
    .counter {
      margin: 18px 0 6px;
      font-weight: 800;
      font-size: clamp(2rem, 6vw, 3rem);
      line-height: 1.15;
      letter-spacing: .02em;
      word-wrap: break-word;
    }
    .sub {
      color: var(--muted);
      margin: 0;
      font-size: clamp(.9rem, .9rem + .4vw, 1rem);
      word-break: break-word;
    }
    .dates {
      margin-top: 16px;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    .row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: var(--card);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 14px;
      padding: 10px 14px;
      font-variant-numeric: tabular-nums;
      box-sizing: border-box;
      overflow-wrap: anywhere;
    }
    .row span.label { color: var(--muted); }
    .controls {
      margin-top: 18px;
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }
    button {
      cursor: pointer;
      background: var(--accent);
      color: #081226;
      font-weight: 700;
      border: none;
      border-radius: 12px;
      padding: 10px 14px;
      transition: transform .05s ease;
      max-width: 100%;
    }
    button:active { transform: translateY(1px); }
    .hint { color: var(--muted); font-size: .85rem; word-break: break-word; }
    .sep { height: 1px; background: rgba(255,255,255,.08); margin: 16px 0; }
    .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0,0,0,0); white-space: nowrap; border: 0; }

    /* スマホビュー最適化 */
    @media (max-width: 600px) {
      .dates {
        grid-template-columns: 1fr;
      }
      .title {
        font-size: 1.1rem;
      }
      .counter {
        font-size: 2rem;
      }
      .card {
        padding: 16px;
        border-radius: 14px;
      }
      .controls {
        flex-direction: column;
        align-items: stretch;
      }
      button {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <main class="card" aria-labelledby="title">
      <h1 id="title" class="title">📔 8月13日から今日で何日目？ <span class="pill" id="tz-pill" aria-live="polite"></span></h1>
      <div class="counter" id="count" aria-live="polite" aria-atomic="true">…</div>
      <p class="sub" id="desc">読み込み中…</p>
      <p class="sub" id="chars">日記の文字数を計算中…</p>

      <div class="dates" aria-describedby="title">
        <div class="row"><span class="label">開始日</span><span id="start"></span></div>
        <div class="row"><span class="label">今日</span><span id="today"></span></div>
      </div>

      <div class="sep" role="presentation"></div>

      <div class="controls">
        <button id="refresh" type="button" title="最新の状態に更新">再計算</button>
        <span class="hint">※ 開始日は毎年の <strong>8月13日</strong>。<br class="sr-only">今年の8/13より前なら昨年の8/13を開始日として計算します（開始日を1日目）。</span>
      </div>
    </main>
  </div>

  <script>
    (function () {
      const REF_MONTH = 8;  // 8月
      const REF_DAY = 13;   // 13日
      const CHARS_PER_DAY = 100;

      const $ = (id) => document.getElementById(id);
      const fmt = new Intl.DateTimeFormat(undefined, { year: 'numeric', month: 'long', day: 'numeric', weekday: 'short' });

      function atLocalMidnight(d) {
        return new Date(d.getFullYear(), d.getMonth(), d.getDate());
      }

      function getStartDateForToday(today) {
        const y = today.getFullYear();
        const candidate = new Date(y, REF_MONTH - 1, REF_DAY);
        return today >= atLocalMidnight(candidate) ? candidate : new Date(y - 1, REF_MONTH - 1, REF_DAY);
      }

      function calc() {
        const now = new Date();
        const today = atLocalMidnight(now);
        const start = atLocalMidnight(getStartDateForToday(today));
        const diffMs = today - start; // 00:00 同士で安全に計算
        const daysFromStart = Math.floor(diffMs / 86_400_000) + 1; // 開始日を1日目
        const charsWritten = daysFromStart * CHARS_PER_DAY;

        // UI 更新
        $('count').textContent = `${daysFromStart}日目`;
        $('desc').textContent = `日記開始（${fmt.format(start)}）からの経過日数です。`;
        $('chars').textContent = `1日100字なら、これまでに約 ${charsWritten.toLocaleString()} 文字書いたことになります。`;
        $('start').textContent = fmt.format(start);
        $('today').textContent = fmt.format(today);

        try {
          const tz = Intl.DateTimeFormat().resolvedOptions().timeZone;
          $('tz-pill').textContent = tz ? `現地時刻: ${tz}` : '現地時刻';
        } catch { /* no-op */ }

        return { daysFromStart, start, today };
      }

      // 初回
      calc();

      // 手動リフレッシュ
      $('refresh').addEventListener('click', calc);

      // 日付が変わったら自動で更新（次の真夜中に再計算）
      (function scheduleMidnightUpdate() {
        const now = new Date();
        const nextMidnight = new Date(now.getFullYear(), now.getMonth(), now.getDate() + 1);
        const ms = +nextMidnight - +now;
        setTimeout(() => { calc(); scheduleMidnightUpdate(); }, ms + 50);
      })();
    })();
  </script>
</body>
</html>
